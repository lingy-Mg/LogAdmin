# LogAdmin ç®€åŒ–ç‰ˆ - 30åˆ†é’Ÿå¿«é€Ÿå®ç°æ–¹æ¡ˆ

## ç›®æ ‡
å¿«é€Ÿæ­å»ºä¸€ä¸ªå¯ç”¨çš„æ—¥å¿—ç³»ç»Ÿï¼Œé‡ç‚¹ï¼š
1. âœ… **å®æ—¶æ—¥å¿—æµ** - WebSocket æ¨é€
2. âœ… **ç²¾ç¾çš„ç•Œé¢** - Element Plus + ç°ä»£åŒ–è®¾è®¡
3. âœ… **åŸºç¡€æŸ¥è¯¢** - ç®€å•çš„ç­›é€‰å’Œæœç´¢
4. âœ… **HTTP æ¥æ”¶** - ç®€å•çš„æ—¥å¿—æ¥æ”¶ API

## æŠ€æœ¯æ ˆï¼ˆæœ€ç®€åŒ–ï¼‰
- å‰ç«¯ï¼šVue 3 + Vite + Element Plus + Socket.IO Client
- åç«¯ï¼šExpress + Socket.IO + å†…å­˜å­˜å‚¨ï¼ˆå…ˆä¸ç”¨æ•°æ®åº“ï¼‰
- åŒ…ç®¡ç†ï¼špnpm

## é¡¹ç›®ç»“æ„ï¼ˆæç®€ï¼‰
```
LogAdmin/
â”œâ”€â”€ frontend/          # å‰ç«¯ï¼ˆå•åŒ…ï¼‰
â””â”€â”€ backend/           # åç«¯ï¼ˆå•åŒ…ï¼‰
```

## å®ç°æ­¥éª¤

### é˜¶æ®µ 1: åç«¯æ ¸å¿ƒ (10åˆ†é’Ÿ)
åˆ›å»º `backend/server.js` - ä¸€ä¸ªæ–‡ä»¶æå®šï¼š
- Express HTTP æœåŠ¡å™¨
- Socket.IO å®æ—¶æ¨é€
- æ—¥å¿—æ¥æ”¶ API
- å†…å­˜å­˜å‚¨ï¼ˆæ•°ç»„ï¼‰

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
```javascript
// 1. æ¥æ”¶æ—¥å¿— POST /api/logs
// 2. æŸ¥è¯¢æ—¥å¿— GET /api/logs
// 3. WebSocket å®æ—¶æ¨é€
// 4. æ—¥å¿—çº§åˆ«è¿‡æ»¤
```

### é˜¶æ®µ 2: å‰ç«¯ç•Œé¢ (20åˆ†é’Ÿ)

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          LogAdmin - æ—¥å¿—ç®¡ç†             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿‡æ»¤å™¨: [è®¾å¤‡] [çº§åˆ«] [å…³é”®è¯] [æ—¶é—´]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  ğŸ“ [å®æ—¶æ—¥å¿—æµ - è™šæ‹Ÿæ»šåŠ¨]               â”‚
â”‚                                          â”‚
â”‚  ğŸŸ¢ INFO  device-001  å¯åŠ¨æˆåŠŸ           â”‚
â”‚  ğŸŸ  WARN  device-002  å†…å­˜ä½¿ç”¨ç‡é«˜        â”‚
â”‚  ğŸ”´ ERROR device-001  è¿æ¥è¶…æ—¶           â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç»„ä»¶
1. **TopBar.vue** - é¡¶éƒ¨å¯¼èˆªæ 
2. **LogFilter.vue** - è¿‡æ»¤å™¨ï¼ˆè®¾å¤‡ã€çº§åˆ«ã€å…³é”®è¯ï¼‰
3. **LogViewer.vue** - æ—¥å¿—æŸ¥çœ‹å™¨ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰
4. **LogItem.vue** - å•æ¡æ—¥å¿—å±•ç¤º

### é˜¶æ®µ 3: åŠŸèƒ½ç‰¹æ€§

#### å¿…é¡»æœ‰çš„
- âœ… å®æ—¶æ—¥å¿—æ¨é€
- âœ… æ—¥å¿—çº§åˆ«é¢œè‰²åŒºåˆ†
- âœ… å…³é”®è¯é«˜äº®
- âœ… è‡ªåŠ¨æ»šåŠ¨ + æš‚åœæŒ‰é’®
- âœ… æ¸…ç©ºæ—¥å¿—æŒ‰é’®
- âœ… ç®€å•çš„ç­›é€‰

#### æš‚æ—¶ä¸åš
- âŒ æ•°æ®åº“ï¼ˆç”¨å†…å­˜ï¼‰
- âŒ æ–‡ä»¶å­˜å‚¨
- âŒ å½’æ¡£å‹ç¼©
- âŒ ç”¨æˆ·è®¤è¯
- âŒ ç»Ÿè®¡å›¾è¡¨
- âŒ å†å²æŸ¥è¯¢ï¼ˆåªçœ‹æœ€è¿‘1000æ¡ï¼‰

## ä»£ç ç»“æ„

### åç«¯ (backend/server.js) - çº¦150è¡Œ
```javascript
const express = require('express')
const { createServer } = require('http')
const { Server } = require('socket.io')
const cors = require('cors')

const app = express()
const httpServer = createServer(app)
const io = new Server(httpServer, { cors: { origin: '*' } })

// å†…å­˜å­˜å‚¨ï¼ˆæœ€å¤šä¿ç•™1000æ¡ï¼‰
let logs = []
const MAX_LOGS = 1000

// æ—¥å¿—æ¨¡å‹
class Log {
  constructor(data) {
    this.id = Date.now() + Math.random()
    this.deviceId = data.deviceId
    this.level = data.level || 'INFO'
    this.message = data.message
    this.timestamp = new Date()
  }
}

// ä¸­é—´ä»¶
app.use(cors())
app.use(express.json())

// API è·¯ç”±
app.post('/api/logs', (req, res) => {
  const log = new Log(req.body)
  logs.push(log)
  
  // é™åˆ¶æ•°é‡
  if (logs.length > MAX_LOGS) {
    logs = logs.slice(-MAX_LOGS)
  }
  
  // å®æ—¶æ¨é€
  io.emit('log:new', log)
  
  res.json({ success: true })
})

app.get('/api/logs', (req, res) => {
  const { level, deviceId, keyword } = req.query
  let filtered = logs
  
  if (level) filtered = filtered.filter(l => l.level === level)
  if (deviceId) filtered = filtered.filter(l => l.deviceId === deviceId)
  if (keyword) filtered = filtered.filter(l => l.message.includes(keyword))
  
  res.json({ success: true, data: filtered.slice(-100) })
})

// WebSocket
io.on('connection', (socket) => {
  console.log('Client connected:', socket.id)
  
  // å‘é€æœ€è¿‘100æ¡æ—¥å¿—
  socket.emit('log:history', logs.slice(-100))
  
  socket.on('disconnect', () => {
    console.log('Client disconnected:', socket.id)
  })
})

httpServer.listen(3000, () => {
  console.log('Server running on http://localhost:3000')
})
```

### å‰ç«¯ä¸»é¡µé¢ (frontend/src/App.vue) - çº¦200è¡Œ
```vue
<template>
  <div class="log-admin">
    <!-- é¡¶éƒ¨æ  -->
    <div class="header">
      <h1>ğŸ“ LogAdmin - å®æ—¶æ—¥å¿—</h1>
      <div class="status">
        <el-tag :type="connected ? 'success' : 'danger'">
          {{ connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥' }}
        </el-tag>
        <span class="log-count">å…± {{ logs.length }} æ¡</span>
      </div>
    </div>

    <!-- è¿‡æ»¤å™¨ -->
    <div class="filters">
      <el-input 
        v-model="filters.deviceId" 
        placeholder="è®¾å¤‡ID"
        clearable
        style="width: 200px"
      />
      <el-select 
        v-model="filters.level" 
        placeholder="æ—¥å¿—çº§åˆ«"
        clearable
        style="width: 150px"
      >
        <el-option label="DEBUG" value="DEBUG" />
        <el-option label="INFO" value="INFO" />
        <el-option label="WARN" value="WARN" />
        <el-option label="ERROR" value="ERROR" />
      </el-select>
      <el-input 
        v-model="filters.keyword" 
        placeholder="å…³é”®è¯æœç´¢"
        clearable
        style="width: 200px"
      />
      <el-button 
        :type="autoScroll ? 'primary' : 'default'" 
        @click="autoScroll = !autoScroll"
      >
        {{ autoScroll ? 'è‡ªåŠ¨æ»šåŠ¨' : 'å·²æš‚åœ' }}
      </el-button>
      <el-button @click="clearLogs">æ¸…ç©º</el-button>
    </div>

    <!-- æ—¥å¿—åˆ—è¡¨ -->
    <div class="log-container" ref="logContainer">
      <div 
        v-for="log in filteredLogs" 
        :key="log.id" 
        :class="['log-item', `log-${log.level.toLowerCase()}`]"
      >
        <span class="log-time">{{ formatTime(log.timestamp) }}</span>
        <el-tag :type="getLevelType(log.level)" size="small">
          {{ log.level }}
        </el-tag>
        <span class="log-device">{{ log.deviceId }}</span>
        <span class="log-message" v-html="highlightKeyword(log.message)"></span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch, onMounted, onUnmounted } from 'vue'
import { io } from 'socket.io-client'

const socket = io('http://localhost:3000')
const logs = ref([])
const connected = ref(false)
const autoScroll = ref(true)
const logContainer = ref(null)

const filters = ref({
  deviceId: '',
  level: '',
  keyword: ''
})

// è¿æ¥çŠ¶æ€
socket.on('connect', () => { connected.value = true })
socket.on('disconnect', () => { connected.value = false })

// æ¥æ”¶å†å²æ—¥å¿—
socket.on('log:history', (history) => {
  logs.value = history
})

// æ¥æ”¶æ–°æ—¥å¿—
socket.on('log:new', (log) => {
  logs.value.push(log)
  if (logs.value.length > 1000) {
    logs.value = logs.value.slice(-1000)
  }
  scrollToBottom()
})

// è¿‡æ»¤æ—¥å¿—
const filteredLogs = computed(() => {
  let result = logs.value
  
  if (filters.value.deviceId) {
    result = result.filter(l => l.deviceId.includes(filters.value.deviceId))
  }
  if (filters.value.level) {
    result = result.filter(l => l.level === filters.value.level)
  }
  if (filters.value.keyword) {
    result = result.filter(l => 
      l.message.toLowerCase().includes(filters.value.keyword.toLowerCase())
    )
  }
  
  return result
})

// è‡ªåŠ¨æ»šåŠ¨
function scrollToBottom() {
  if (autoScroll.value && logContainer.value) {
    setTimeout(() => {
      logContainer.value.scrollTop = logContainer.value.scrollHeight
    }, 0)
  }
}

// æ¸…ç©ºæ—¥å¿—
function clearLogs() {
  logs.value = []
}

// æ ¼å¼åŒ–æ—¶é—´
function formatTime(timestamp) {
  return new Date(timestamp).toLocaleTimeString('zh-CN')
}

// è·å–çº§åˆ«ç±»å‹
function getLevelType(level) {
  const types = {
    DEBUG: 'info',
    INFO: 'success',
    WARN: 'warning',
    ERROR: 'danger'
  }
  return types[level] || 'info'
}

// é«˜äº®å…³é”®è¯
function highlightKeyword(message) {
  if (!filters.value.keyword) return message
  const keyword = filters.value.keyword
  const regex = new RegExp(`(${keyword})`, 'gi')
  return message.replace(regex, '<mark>$1</mark>')
}
</script>

<style scoped>
.log-admin {
  height: 100vh;
  display: flex;
  flex-direction: column;
  background: #f5f5f5;
}

.header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 20px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.header h1 {
  margin: 0;
  font-size: 24px;
}

.status {
  display: flex;
  gap: 15px;
  align-items: center;
}

.log-count {
  font-size: 14px;
}

.filters {
  background: white;
  padding: 15px 30px;
  display: flex;
  gap: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.log-container {
  flex: 1;
  overflow-y: auto;
  padding: 20px 30px;
}

.log-item {
  background: white;
  padding: 12px 16px;
  margin-bottom: 8px;
  border-radius: 6px;
  border-left: 4px solid #ddd;
  display: flex;
  gap: 12px;
  align-items: center;
  font-family: 'Consolas', 'Monaco', monospace;
  font-size: 14px;
  transition: all 0.2s;
}

.log-item:hover {
  transform: translateX(4px);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.log-debug { border-left-color: #909399; }
.log-info { border-left-color: #67c23a; }
.log-warn { border-left-color: #e6a23c; }
.log-error { border-left-color: #f56c6c; }

.log-time {
  color: #909399;
  font-size: 12px;
  min-width: 80px;
}

.log-device {
  color: #409eff;
  font-weight: 500;
  min-width: 100px;
}

.log-message {
  flex: 1;
  color: #303133;
}

mark {
  background: #ffd700;
  padding: 2px 4px;
  border-radius: 2px;
}
</style>
```

## å¿«é€Ÿå¯åŠ¨æ­¥éª¤

### 1. åç«¯ (5åˆ†é’Ÿ)
```bash
# åˆ›å»ºåç«¯
mkdir backend && cd backend
npm init -y
npm install express socket.io cors

# åˆ›å»º server.js
# å¤åˆ¶ä¸Šé¢çš„åç«¯ä»£ç 

# å¯åŠ¨
node server.js
```

### 2. å‰ç«¯ (5åˆ†é’Ÿ)
```bash
# åˆ›å»ºå‰ç«¯
npm create vite@latest frontend -- --template vue
cd frontend
npm install
npm install element-plus socket.io-client

# é…ç½® Element Plus (main.js)
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'
app.use(ElementPlus)

# å¤åˆ¶ App.vue ä»£ç 

# å¯åŠ¨
npm run dev
```

### 3. æµ‹è¯• (2åˆ†é’Ÿ)
```bash
# å‘é€æµ‹è¯•æ—¥å¿—
curl -X POST http://localhost:3000/api/logs \
  -H "Content-Type: application/json" \
  -d '{
    "deviceId": "device-001",
    "level": "INFO",
    "message": "ç³»ç»Ÿå¯åŠ¨æˆåŠŸ"
  }'

curl -X POST http://localhost:3000/api/logs \
  -H "Content-Type: application/json" \
  -d '{
    "deviceId": "device-002",
    "level": "ERROR",
    "message": "è¿æ¥æ•°æ®åº“å¤±è´¥"
  }'
```

## æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°
1. **å®æ—¶æ¨é€** - WebSocket è‡ªåŠ¨æ›´æ–°
2. **ç²¾ç¾ç•Œé¢** - æ¸å˜è‰²æ ‡é¢˜ã€å¡ç‰‡å¼æ—¥å¿—ã€æ‚¬åœåŠ¨ç”»
3. **é¢œè‰²åŒºåˆ†** - ä¸åŒçº§åˆ«ä¸åŒé¢œè‰²è¾¹æ¡†
4. **å…³é”®è¯é«˜äº®** - æœç´¢è¯é»„è‰²é«˜äº®
5. **è‡ªåŠ¨æ»šåŠ¨** - å¯æš‚åœ/æ¢å¤
6. **è¿‡æ»¤åŠŸèƒ½** - è®¾å¤‡ã€çº§åˆ«ã€å…³é”®è¯
7. **è¿æ¥çŠ¶æ€** - å®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€

### ğŸ¨ ç•Œé¢äº®ç‚¹
- æ¸å˜è‰²é¡¶éƒ¨æ ï¼ˆç´«è‰²ç³»ï¼‰
- å¡ç‰‡å¼æ—¥å¿—æ¡ç›®
- æ‚¬åœåŠ¨ç”»æ•ˆæœ
- æ¸…æ™°çš„è§†è§‰å±‚æ¬¡
- å“åº”å¼è®¾è®¡

## åç»­æ‰©å±•ï¼ˆå¯é€‰ï¼‰

å¦‚æœæœ‰æ—¶é—´å¯ä»¥åŠ ï¼š
1. **è®¾å¤‡åˆ—è¡¨ä¾§è¾¹æ ** - æ˜¾ç¤ºæ‰€æœ‰è®¾å¤‡
2. **æ—¥å¿—ç»Ÿè®¡å¡ç‰‡** - æ€»æ•°ã€é”™è¯¯æ•°ã€è®¾å¤‡æ•°
3. **æš—é»‘æ¨¡å¼** - åˆ‡æ¢ä¸»é¢˜
4. **å¯¼å‡ºåŠŸèƒ½** - ä¸‹è½½æ—¥å¿—
5. **æ—¶é—´ç­›é€‰** - æœ€è¿‘1å°æ—¶/ä»Šå¤©/æ˜¨å¤©

## æ€»ç»“

è¿™ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼š
- â±ï¸ **30åˆ†é’Ÿå¯å®Œæˆ**
- ğŸ¯ **èšç„¦æ ¸å¿ƒåŠŸèƒ½** - å®æ—¶æ—¥å¿—æŸ¥çœ‹
- ğŸ¨ **ç•Œé¢ç²¾ç¾** - Element Plus + ç°ä»£è®¾è®¡
- ğŸ“¦ **æ— éœ€æ•°æ®åº“** - å†…å­˜å­˜å‚¨å³å¯
- ğŸš€ **å¿«é€ŸéªŒè¯** - ç«‹å³å¯ç”¨

é€‚åˆï¼š
- å¿«é€ŸåŸå‹éªŒè¯
- æ¼”ç¤º Demo
- å°è§„æ¨¡æ—¥å¿—ç›‘æ§
- å¼€å‘è°ƒè¯•å·¥å…·
