# LogAdmin éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

### 1. æœ¬åœ°ç¯å¢ƒ
- âœ… Node.js å·²å®‰è£…
- âœ… SSH å¯†é’¥å·²é…ç½®
- âœ… å¯ä»¥é€šè¿‡ SSH è¿æ¥åˆ°æœåŠ¡å™¨

### 2. æœåŠ¡å™¨ç¯å¢ƒ
- âœ… Node.js (v14+)
- âœ… PM2 è¿›ç¨‹ç®¡ç†å™¨
- âœ… SSH å¯†é’¥è®¤è¯å·²é…ç½®

## ğŸ”‘ SSH å¯†é’¥é…ç½®

### æ£€æŸ¥æœ¬åœ°å¯†é’¥
```bash
# Windows PowerShell
dir $HOME\.ssh

# åº”è¯¥çœ‹åˆ° id_rsa å’Œ id_rsa.pub
```

### å¦‚æœæ²¡æœ‰å¯†é’¥ï¼Œç”Ÿæˆæ–°å¯†é’¥
```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

### å°†å…¬é’¥æ·»åŠ åˆ°æœåŠ¡å™¨
```bash
# æ–¹æ³• 1: ä½¿ç”¨ ssh-copy-idï¼ˆå¦‚æœå¯ç”¨ï¼‰
ssh-copy-id -i ~/.ssh/id_rsa.pub user@aliyun.18638642193.cn

# æ–¹æ³• 2: æ‰‹åŠ¨å¤åˆ¶
# 1. æŸ¥çœ‹å…¬é’¥å†…å®¹
cat ~/.ssh/id_rsa.pub

# 2. ç™»å½•æœåŠ¡å™¨
ssh user@aliyun.18638642193.cn

# 3. æ·»åŠ åˆ° authorized_keys
mkdir -p ~/.ssh
echo "your_public_key_content" >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
chmod 700 ~/.ssh
```

## âš™ï¸ é…ç½®éƒ¨ç½²å‚æ•°

### 1. å¤åˆ¶é…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp deploy.config.json.example deploy.config.json
```

### 2. ä¿®æ”¹ deploy.config.json
```json
{
  "host": "aliyun.18638642193.cn",
  "user": "root",
  "port": 22,
  "keyPath": "~/.ssh/id_rsa",
  "remotePath": "/var/www/logadmin",
  "pm2Name": "logadmin"
}
```

é…ç½®è¯´æ˜ï¼š
- `host`: æœåŠ¡å™¨åŸŸåæˆ– IP
- `user`: SSH ç™»å½•ç”¨æˆ·å
- `port`: SSH ç«¯å£ï¼ˆé»˜è®¤ 22ï¼‰
- `keyPath`: SSH ç§é’¥è·¯å¾„ï¼ˆæ”¯æŒ ~ ç¬¦å·ï¼‰
- `remotePath`: æœåŠ¡å™¨éƒ¨ç½²ç›®å½•
- `pm2Name`: PM2 è¿›ç¨‹åç§°

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³• 1: ä½¿ç”¨ npm å‘½ä»¤
```bash
npm run deploy
```

### æ–¹æ³• 2: ä½¿ç”¨æ‰¹å¤„ç†æ–‡ä»¶ï¼ˆWindowsï¼‰
```bash
.\deploy.bat
```

### æ–¹æ³• 3: æ‰‹åŠ¨æ‰§è¡Œ
```bash
node scripts/deploy.js
```

## ğŸ“¦ éƒ¨ç½²æµç¨‹

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ¸…ç†æ—§æ„å»º** - åˆ é™¤æ—§çš„æ„å»ºæ–‡ä»¶
2. **æ„å»ºå‰ç«¯** - ç¼–è¯‘å‰ç«¯ä»£ç 
3. **æ£€æŸ¥ SSH å¯†é’¥** - éªŒè¯å¯†é’¥æ˜¯å¦å­˜åœ¨
4. **åˆ›å»ºéƒ¨ç½²åŒ…** - æ‰“åŒ…éœ€è¦éƒ¨ç½²çš„æ–‡ä»¶
5. **ä¸Šä¼ å¹¶éƒ¨ç½²** - ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶å¯åŠ¨æœåŠ¡

## ğŸ”§ æœåŠ¡å™¨ç«¯é…ç½®

### é¦–æ¬¡éƒ¨ç½²éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… PM2
```bash
# ç™»å½•æœåŠ¡å™¨
ssh user@aliyun.18638642193.cn

# å®‰è£… PM2
npm install -g pm2

# é…ç½® PM2 å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

### PM2 å¸¸ç”¨å‘½ä»¤
```bash
# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs logadmin

# é‡å¯åº”ç”¨
pm2 restart logadmin

# åœæ­¢åº”ç”¨
pm2 stop logadmin

# åˆ é™¤åº”ç”¨
pm2 delete logadmin

# ç›‘æ§
pm2 monit
```

## ğŸŒ è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—®ï¼š
```
http://aliyun.18638642193.cn
```

## â“ å¸¸è§é—®é¢˜

### 1. SSH è¿æ¥å¤±è´¥
```
é”™è¯¯: Permission denied (publickey)
```
**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ SSH å¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤å…¬é’¥å·²æ·»åŠ åˆ°æœåŠ¡å™¨ `~/.ssh/authorized_keys`
- æ£€æŸ¥å¯†é’¥æƒé™: `chmod 600 ~/.ssh/id_rsa`

### 2. æƒé™ä¸è¶³
```
é”™è¯¯: EACCES: permission denied
```
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿æœåŠ¡å™¨ä¸Šçš„éƒ¨ç½²ç›®å½•æœ‰å†™å…¥æƒé™
- æˆ–ä½¿ç”¨ sudo: ä¿®æ”¹ deploy.js ä¸­çš„å‘½ä»¤æ·»åŠ  sudo

### 3. PM2 æœªå®‰è£…
```
é”™è¯¯: pm2: command not found
```
**è§£å†³æ–¹æ¡ˆ**:
```bash
npm install -g pm2
```

### 4. ç«¯å£è¢«å ç”¨
**è§£å†³æ–¹æ¡ˆ**:
- ä¿®æ”¹ backend/src/config/index.js ä¸­çš„ç«¯å£é…ç½®
- æˆ–åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹

## ğŸ”„ å›æ»š

å¦‚æœéƒ¨ç½²å‡ºç°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨å›æ»šï¼š

```bash
# ç™»å½•æœåŠ¡å™¨
ssh user@aliyun.18638642193.cn

# è¿›å…¥éƒ¨ç½²ç›®å½•
cd /var/www/logadmin

# ä½¿ç”¨ä¹‹å‰çš„å¤‡ä»½ï¼ˆå¦‚æœæœ‰ï¼‰
# æˆ–è€…é‡æ–°éƒ¨ç½²æ—§ç‰ˆæœ¬
```

## ğŸ“ éƒ¨ç½²æ—¥å¿—

éƒ¨ç½²è¿‡ç¨‹ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼š
- âœ… ç»¿è‰²å‹¾å· = æ­¥éª¤æˆåŠŸ
- âŒ çº¢è‰²å‰å· = æ­¥éª¤å¤±è´¥
- ğŸ“¦ åŒ…è£¹ = æ„å»ºæ‰“åŒ…
- ğŸš¢ è½®èˆ¹ = ä¸Šä¼ éƒ¨ç½²
- ğŸŒ åœ°çƒ = éƒ¨ç½²å®Œæˆ

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¸è¦å°† deploy.config.json æäº¤åˆ° Git**
   - å·²æ·»åŠ åˆ° .gitignore

2. **ä½¿ç”¨å¯†é’¥è€Œéå¯†ç **
   - æ›´å®‰å…¨
   - æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²

3. **é™åˆ¶ SSH è®¿é—®**
   - åªå…è®¸å¯†é’¥ç™»å½•
   - ç¦ç”¨ root å¯†ç ç™»å½•

4. **å®šæœŸå¤‡ä»½**
   - å¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½é…ç½®æ–‡ä»¶

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—: `pm2 logs logadmin`
3. æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—: `journalctl -xe`
